<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="css/style.css">

	<script src="./js/sessao.js"></script>
	<title>Site Bateria</title>
</head>

<body class="body1">

	<div class="header" id="header">
		<img src="img/logo.jpg" class="icone" href="index.html">
		<ul class="itensHeader">
			<li class="itemTom" onclick="trocar('index')">
				<h3>Home</h3>
			</li>
			<li class="itemTom" onclick="trocar('historia')">
				<h3>Historia</h3>
			</li>
			<li class="itemTom" onclick="trocar('tocar')">
				<h3>Tocar</h3>
			</li>
			<!-- <li class="itemTom">
					<h3>Perfil</h3>
				</li>
			-->
		</ul>
		
        <!-- <div class="wave id"></div>
        <div class="wave id2" ></div> -->
	</div>

	<div class="mainI">

		<div class="pg1" id="pg1">
			<img src="img/baquetaD.png" class="imgP1 imgE">
			<h1 class="titulo_pg1">DRUMING - BATUCAR É VIDA</h1>
			<img src="img/baqueta.png" class="imgP1 imgD">
			<!-- <section class="curva"></section> -->
			<!-- <div class="imgEspelho"></div> -->
		</div>

		
	</div>

	
<div class="sidebar">
    <div class="abridor">| | |</div>

    <div class="divCad" id="divLogin">
        <div class="input_titulo inpt_side">
            Login
        </div>
        <div class="inpt_side">
            Email <input type="email" id="emailLogin" name="">
        </div>
        <div class="inpt_side">
            Senha <input type="password" id="senhaLogin" name="">
        </div>
        <div class="inpt_side">
            <button class="btnLogin" onclick="entrar()">Logar</button><br><br>
            <a onclick="aparecer()" class="btnAparecer"><u><i>Não possui cadastro? clique aqui</i></u></a>
        </div>
    </div>

    <div class="divCad" id="divPerfil">
        <div class="input_titulo inpt_side">
            Perfil
        </div>
        <div class="inpt_side">
            <img src="img/macaco.jpg">
        </div>
        <div class="inpt_side">
            <span id="spnNome"></span>
        </div>
        <div class="inpt_side">
            <span id="spnEmail"></span>
        </div>
        <div class="inpt_side">
            <button class="btnLogin" onclick="sair()">sair</button>
        </div>
    </div>

    <div class="divCad" id="divCad" style="display: none;">
        <div class="input_titulo inpt_side">
            Cadastro
        </div>
        <div class="inpt_side">
            Nome <input type="email" id="nomeCad" name="">
        </div>
        <div class="inpt_side">
            Email <input type="email" id="emailCad" name="">
        </div>
        <div class="inpt_side">
            Senha <input type="password" id="senhaCad" name="">
        </div>
        <div class="inpt_side">
            Confirmar Senha <input type="password" id="confsenhaCad" name="">
        </div>
        <!-- <div class="inpt_side">
                CEP <input type="text" id="cepCad" name="">
            </div>
            <div class="inpt_side">
                Numero <input type="email" id="numeroCad" name="">
            </div>
            <div class="inpt_side">
                Complemento <input type="email" id="complementoCad" name="">
            </div> -->
        <div class="inpt_side">
            Data de nascimento <input type="date" id="dtNascCad" name="">
        </div>
        <!-- <div class="inpt_side">
                Quantos anos começou a tocar bateria? <input type="email" id="comecoCad" name="">
            </div>
            <div class="inpt_side">
                Marcafavoria <input type="email" id="emailCad" name="">
            </div> -->
        <div class="inpt_side">
            <button onclick="cadastrar()" class="btnLogin">Cadastrar</button>
            <br><br>
            <a onclick="aparecer()" class="btnAparecer"><u><i>Já possui um cadastro? clique aqui</i></u></a>
        </div>
    </div>


</body>

</html>
<script>

	if (sessionStorage.LOGADO == 1) {
		divLogin.style.display = 'none';
		divPerfil.style.display = 'flex'

		spnNome.innerHTML = sessionStorage.NOME_USUARIO;
		spnEmail.innerHTML = sessionStorage.EMAIL_USUARIO;

	}

	function trocar(pagina) {
		window.location.href = `${pagina}.html`
	}
	function sair() {
		sessionStorage.LOGADO = 0;
		window.location = "index.html";

	}

	function entrar() {
		var emailVar = emailLogin.value;
		var senhaVar = senhaLogin.value;

		if (emailVar == "" || senhaVar == "") {
			alert("(Mensagem de erro para todos os campos em branco)");
			return false;
		}
		else {
			setInterval(sumirMensagem, 5000)
		}

		console.log("FORM LOGIN: ", emailVar);
		console.log("FORM SENHA: ", senhaVar);

		fetch("/usuarios/autenticar", {
			method: "POST",
			headers: {
				"Content-Type": "application/json"
			},
			body: JSON.stringify({
				emailServer: emailVar,
				senhaServer: senhaVar
			})
		}).then(function (resposta) {
			console.log("ESTOU NO THEN DO entrar()!")

			if (resposta.ok) {
				console.log(resposta);

				resposta.json().then(json => {
					console.log(json);
					console.log(JSON.stringify(json));
					sessionStorage.EMAIL_USUARIO = json.email;
					sessionStorage.NOME_USUARIO = json.nome;
					sessionStorage.LOGADO = 1;
					sessionStorage.ID_USUARIO = json.idUsuario;
					sessionStorage.DTNASC = json.dtNasc

					setTimeout(function () {
						window.location = "index.html";
					}, 1000); // apenas para exibir o loading

				});

			} else {

				console.log("Houve um erro ao tentar realizar o login!");

				resposta.text().then(texto => {
					console.error(texto);
				});
			}

		}).catch(function (erro) {
			console.log(erro);
		})

		return false;
	}


	function cadastrar() {

		//Recupere o valor da nova input pelo nome do id
		// Agora vá para o método fetch logo abaixo
		var nomeVar = nomeCad.value;
		var emailVar = emailCad.value;
		var senhaVar = senhaCad.value;
		var confirmacaoSenhaVar = confsenhaCad.value;
		var nascVar = dtNascCad.value;
		if (
			(nomeVar == "" ||
				emailVar == "" ||
				senhaVar == "" ||
				confirmacaoSenhaVar == "" ||
				nascVar == "") && senhaVar == confirmacaoSenhaVar
		) {
			alert(
				"(Mensagem de erro para todos os campos em branco)");

			return false;
		} else {
			setInterval(sumirMensagem, 5000);
		}

		// Enviando o valor da nova input
		fetch("/usuarios/cadastrar", {
			method: "POST",
			headers: {
				"Content-Type": "application/json",
			},
			body: JSON.stringify({
				// crie um atributo que recebe o valor recuperado aqui
				// Agora vá para o arquivo routes/usuario.js
				nomeServer: nomeVar,
				emailServer: emailVar,
				senhaServer: senhaVar,
				nascimentoServer: nascVar
			}),
		})
			.then(function (resposta) {
				console.log("resposta: ", resposta);

				if (resposta.ok) {

					alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...");

					setTimeout(() => {
						window.location = "index.html";
					}, "2000");

					limparFormulario();
				} else {
					throw "Houve um erro ao tentar realizar o cadastro!";
				}
			})
			.catch(function (resposta) {
				console.log(`#ERRO: ${resposta}`);
			});

		return false;
	}

	function sumirMensagem() {
		// cardErro.style.display = "none";
	}







	var delay = 0;
	function aparecer() {

		var disp = divCad.style.display

		if (disp == 'flex') {

			aparecerCad(true)
			setTimeout(() => {

				aparecerLogin(false)
			}, '700')
		} else {

			aparecerLogin(true)
			setTimeout(() => {


				aparecerCad(false)
			}, '700')
		}

	}

	function aparecerLogin(teste) {
		if (teste) {

			divLogin.style.animation = 'aparecerCad 1s reverse'

			setTimeout(() => {
				divLogin.style.display = 'none'
			}, "900");

		} else {

			divLogin.style.animation = 'aparecerBaquetaE 1s'

			setTimeout(() => {
				divLogin.style.display = 'flex'
			}, "900");

		}
	}

	function aparecerCad(teste) {
		if (teste) {
			divCad.style.animation = 'aparecerBaquetaE 1s reverse'
			setTimeout(() => {
				divCad.style.display = 'none'
			}, "900");

		} else {
			divCad.style.animation = 'aparecerCad 1s'
			setTimeout(() => {
				divCad.style.display = 'flex'
			}, "900");
		}
	}
</script>